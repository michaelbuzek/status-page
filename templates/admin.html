<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Testlabor Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
    }
    h1 {
      color: purple;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 40px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
      vertical-align: top;
    }
    .status.pending {
      background-color: orange;
      color: black;
      padding: 6px 10px;
      font-weight: bold;
      border-radius: 4px;
      display: inline-block;
    }
    .status.done {
      background-color: forestgreen;
      color: white;
      padding: 6px 10px;
      font-weight: bold;
      border-radius: 4px;
      display: inline-block;
    }
    input, select, button {
      padding: 6px;
      margin-top: 4px;
    }
    .actions button {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <h1>Testlabor Admin Panel</h1>

  <table id="orders-table">
    <tr>
      <th>ORDER ID</th>
      <th>DATE</th>
      <th>ROUTER</th>
      <th>FW</th>
      <th>RUNS</th>
      <th>STATUS</th>
      <th>REPORT</th>
      <th>AKTIONEN</th>
    </tr>
    {% for item in items %}
    <tr id="row-{{ item.order_id }}">
      <td>{{ item.order_id }}</td>
      <td>{{ item.date }}</td>
      <td>{{ item.router }}</td>
      <td>{{ item.fw }}</td>
      <td>
        {% for run in item.runs %}
          {{ run }}<br>
        {% endfor %}
      </td>
      <td class="status-cell">
        <span class="status {% if 'DONE' in item.status or 'SUCCESS' in item.status %}done{% else %}pending{% endif %}">
          {{ item.status }}
        </span>
      </td>
      <td class="report-cell">
        {% if item.report %}
          <a href="{{ item.report }}" target="_blank">PDF</a>
        {% endif %}
      </td>
      <td class="actions">
        <form action="/delete/{{ item.order_id }}" method="post" style="display:inline;">
          <button type="submit">üóëÔ∏è</button>
        </form>
        <button onclick="enableEdit({{ item.order_id }}, '{{ item.status }}', '{{ item.report or '' }}')">‚úèÔ∏è</button>
      </td>
    </tr>
    {% endfor %}
  </table>

  <h2>‚ûï Neuer Auftrag</h2>
  <form method="post">
    <input type="number" name="order_id" placeholder="Order ID" required>
    <input type="text" name="date" placeholder="Datum" required>
    <input type="text" name="router" placeholder="Router" required>
    <input type="text" name="fw" placeholder="Firmware" required>

    <label for="runs">RUNS:</label>
    <select name="runs" multiple size="5" style="vertical-align: top;">
      <option value="Security">Security</option>
      <option value="WLAN">WLAN</option>
      <option value="Ping">Ping</option>
      <option value="Throughput">Throughput</option>
      <option value="Speedtest">Speedtest</option>
    </select>

    <br><br>
    <button type="submit">Hinzuf√ºgen</button>
  </form>

  <script>
    function enableEdit(orderId, currentStatus, currentReport) {
      const row = document.getElementById(`row-${orderId}`);
      const statusCell = row.querySelector('.status-cell');
      const reportCell = row.querySelector('.report-cell');
      const actionsCell = row.querySelector('.actions');

      // Status bearbeiten
      statusCell.innerHTML = `
        <input type="text" id="status-${orderId}" value="${currentStatus}" />
      `;

      // Report bearbeiten
      reportCell.innerHTML = `
        <input type="text" id="report-${orderId}" value="${currentReport}" />
      `;

      // Aktionen √§ndern
      actionsCell.innerHTML = `
        <button onclick="saveEdit(${orderId})">üíæ Speichern</button>
      `;
    }

    function saveEdit(orderId) {
      const newStatus = document.getElementById(`status-${orderId}`).value;
      const newReport = document.getElementById(`report-${orderId}`).value;

      fetch('/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          order_id: orderId,
          status: newStatus,
          report: newReport
        })
      })
      .then(res => {
        if (res.ok) {
          location.reload();
        } else {
          alert("Update fehlgeschlagen.");
        }
      });
    }
  </script>
</body>
</html>
